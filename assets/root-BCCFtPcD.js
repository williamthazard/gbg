import{p as A,q as L,a as h,o as s,w as G,s as $,M as q,L as C,S as z,t as R,O as T,v as U}from"./chunk-NL6KNZEE-BJIBmkU0.js";let c,f,i,l,w,p,E,j;const M=16,P=8;let B=0,k=1,O=5,F=3,N=16,W=17,V=18,H=19,K=23,X=24,Y=32,J=33,_=!1;typeof window<"u"&&("serial"in navigator?console.log("Web Serial API is supported by this browser."):console.log("Web Serial API is not supported by this browser."));const Q=async()=>{try{if(c=await navigator.serial.requestPort({filters:[{usbVendorId:1155}]}),await c.open({baudRate:115200}),w&&w(),c&&c.readable&&c.writable)for(;c.readable;){f=c.readable.getReader(),i=c.writable.getWriter();try{for(;f;){const{value:r,done:t}=await f.read();if(t)break;r&&r.length>0&&Z(r),_=!0}}catch{}}}catch(r){console.log(r)}};function Z(e){if(!e||e.length<1)return;const r=e[0];if(e.length>=3){const t=e[1],n=e[2];let o=0;if(r===Y){o=0,l&&l(t,n,o);return}if(r===J){o=1,l&&l(t,n,o);return}if(r===0){o=0,l&&l(t,n,o);return}if(r===1){o=1,l&&l(t,n,o);return}}switch(r){case B:if(e.length>=3){const t=e[1],n=e[2];console.log(`Device section ${t} has ${n} components`),t===1&&console.log(`Status: Connected - Grid with ${n} components`)}break;case k:if(e.length>1){const t=e.slice(1),o=new TextDecoder().decode(t).trim();console.log(`Device ID: ${o}`)}break;case F:e.length>=3&&(E=e[1],j=e[2],console.log(`Grid size: ${E}x${j}`));break;default:e.length===3&&console.log(`Potential key event: type=0x${r.toString(16)}, x=${e[1]}, y=${e[2]}`);break}}async function ee(e,r,t){if(i)try{const n=t?W:N,o=new Uint8Array([n,e,r]);await i.write(o)}catch(n){console.error("Error sending LED command:",n)}}async function re(e){l=e}async function te(e){w=e}async function ne(e){p=e}async function oe(e,r,t){if(i)try{t=Math.max(0,Math.min(15,t));const n=new Uint8Array([X,e,r,t]);await i.write(n)}catch(n){console.error("Error setting LED level:",n)}}async function D(){if(i)try{const e=new Uint8Array([V]);await i.write(e)}catch(e){console.error("Error clearing grid:",e)}}async function se(){if(i)try{const e=new Uint8Array([H]);await i.write(e)}catch(e){console.error("Error filling grid:",e)}}async function ie(e){if(i)try{e=Math.max(0,Math.min(15,e));const r=new Uint8Array([K,e]);await i.write(r)}catch(r){console.error("Error setting grid intensity:",r)}}async function ce(){if(_=!1,i)try{await D(),p&&p(),i.releaseLock()}catch(e){console.error("Error releasing writer:",e)}if(f)try{f.cancel(),f.releaseLock()}catch(e){console.error("Error canceling reader:",e)}if(c){try{await c.close()}catch(e){console.error("Error closing port:",e)}c=null}}async function ae(){if(i)try{const e=new Uint8Array([k]);await i.write(e)}catch(e){console.error("Error querying device ID:",e)}}async function le(){if(i)try{const e=new Uint8Array([O]);await i.write(e)}catch(e){console.error("Error querying grid size:",e)}}const d={connect:Q,remove:ce,led:oe,setLed:ee,key:re,connected:te,removed:ne,clear:D,all:se,intensity:ie,id:ae,size:le,cols:M,rows:P};function de({connection:e,dirty:r}){if(typeof window<"u"){let t=A(),n=L();h.useEffect(()=>{const o=document.getElementsByTagName("a"),u=()=>{if(e&&r){d.clear();for(let a=0;a<o.length;a++)d.led(a,0,2);r=!1}};u();const g=setInterval(u,1e3/120);return d.key((a,m,x)=>{d.led(a,m,x*15);for(let y=0;y<o.length;y++)if(a<=y&&m==0)if(x==1&&a==y){var v=o[a].href,I=v.lastIndexOf("/"),S=v.substring(I+1),b="/"+S;console.log("navigating to "+b+" with monome grid"),n(b),r=!0}else d.led(a,m,2)}),()=>clearInterval(g)},[e,t])}return s.jsx(s.Fragment,{})}const ue=()=>[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"}];function ge({children:e}){const[r,t]=h.useState(!1),[n,o]=h.useState("Connect"),[u,g]=h.useState(!1);return d.connected(()=>{console.log("monome grid connected via webserial"),t(!0),o("Disconnect"),g(!0)}),d.removed(()=>{console.log("monome grid disconnected from webserial"),t(!1),o("Connect"),g(!1)}),s.jsxs("html",{lang:"en",children:[s.jsxs("head",{children:[s.jsx("meta",{charSet:"utf-8"}),s.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),s.jsx(q,{}),s.jsx(C,{})]}),s.jsxs("body",{children:[e,s.jsx(z,{}),s.jsx(R,{}),s.jsx("div",{className:"fixed bottom-20 right-20",children:s.jsxs("button",{onClick:r?()=>{d.remove()}:()=>{d.connect()},children:[n," Grid"]})}),s.jsx(de,{connection:r,dirty:u})]})]})}const ye=G(function(){return s.jsx(T,{})}),he=$(function({error:r}){let t="Oops!",n="An unexpected error occurred.",o;return U(r)&&(t=r.status===404?"404":"Error",n=r.status===404?"The requested page could not be found.":r.statusText||n),s.jsxs("main",{className:"pt-16 p-4 container mx-auto",children:[s.jsx("h1",{children:t}),s.jsx("p",{children:n}),o]})});export{he as ErrorBoundary,ge as Layout,ye as default,ue as links};
